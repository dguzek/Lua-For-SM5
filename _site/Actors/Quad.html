<!DOCTYPE html>
<html>
	<head>
	    <meta charset='utf-8'>
	    <meta http-equiv="X-UA-Compatible" content="chrome=1">
	    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700' rel='stylesheet' type='text/css'>
	    <link rel="stylesheet" type="text/css" href="../../stylesheets/stylesheet.css" media="screen">
	    <link rel="stylesheet" type="text/css" href="../../stylesheets/github-light.css" media="screen">
	    <link rel="stylesheet" type="text/css" href="../../stylesheets/print.css" media="print">

	    <!--[if lt IE 9]>
	    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	    <![endif]-->

	    <title>Lua for SM5: Chapter 1 – Quad</title>
	</head>
	
	<body>
	
	<header>
	<div class="inner">
		<div class="title">
			<a href="/">
				<h1>
					Lua for SM5
					<img src="/images/sm5-logo.png">
				</h1>
			</a>
			<h2>Lua Scripting for StepMania 5</h2>
			
		</div>
		<a href="https://github.com/dguzek/Lua-For-SM5" class="button">
			 <small>View project on</small> GitHub
		</a>
	</div>
</header>	
	<div id="content-wrapper">
		<div class="inner clearfix">
			<section id="main-content">
				<h2 id="section-11--quad">Section 1.1 – Quad</h2>

<p><em>Quad</em> Actors haven’t changed notably since SM3.95.  They are programmatically
drawn <em>quad</em>rilaterals that can have properties like size, position, and color.</p>

<p>Since Quads are fairly simple, we’ll also use this example to demonstrate a
few new-to-SM5 features and shortcuts.</p>

<p>```lua
– let’s assume this file is being called via FGCHANGES from a simfile.
– Like in SM3.95, Actors from FGCHANGES disappear immediately unless
– they, or their parent ActorFrame, are slept for some length of time.
return Def.ActorFrame{
	– the OnCommand here applies to the primary ActorFrame
	OnCommand=cmd(sleep,9999),</p>

<pre><code>-- a red quad that accelerates from offscreen-left to offscreen-right
-- this makes use of the _screen and Color aliases
Def.Quad{
	Name="RedQuad",
	InitCommand=cmd(zoomto,100,100; diffuse, Color.Red),
	OnCommand=cmd(xy, -100, _screen.cy;  accelerate, 2; x, _screen.w + 100)
},

-- a blue quad that decelerates from offscreen-top to offscreen-bottom
-- this makes use of the xy() command, which is new to SM5
-- as well as command-chaining (read more on the next page!)
Def.Quad{
	Name="BlueQuad",
	InitCommand=cmd(zoomto,100,100; diffuse, Color.Blue),
	OnCommand=function(self)
		self:xy( _screen.cx, -100)
		self:decelerate(2):y(_screen.h + 100)
		self:queuecommand( "TriggerSpin" )
	end,
	TriggerSpinCommand=function(self)
		self:GetChild("GreenQuad"):queuecommand("Spin")
	end
},

-- a green quad that waits for the two quads above to finish tweening,
-- then grows out of the center of the screen while spinning
-- this makes use of the Center() command, which is new to SM5
Def.Quad{
	Name="GreenQuad",
	InitCommand=cmd(zoomto,0,0; diffuse, Color.Green),
	SpinCommand=function(self)
		self:Center()
		self:effectmagnitude(0,0,1):spin()
		self:linear(5):effectmagnitude(0,0,10):zoomto(_screen.w, _screen.w)
	endx
} } ```
</code></pre>

<p>There are three things worth pointing out here.</p>

<p>First, this example features three unique Quads acting independently within a
single ActorFrame.  Because StepMania expects one actor to be returned per
file, we return the primary ActorFrame, which includes the Quads inside.</p>

<p>Second, this example also uses a few helper tables defined in SM5’s <em>_fallback</em> theme such as the
<code>Color</code> table and the <code>_screen</code> table which are defined in <a href="https://github.com/stepmania/stepmania/blob/master/Themes/_fallback/Scripts/02\%20Colors.lua">02 Colors.lua</a>  and <a href="https://github.com/stepmania/stepmania/blob/master/Themes/_fallback/Scripts/01\%20alias.lua">01 alias.lua</a> respectively</p>

<p>Finally, this example introduces a new way to apply multiple commands to the
same Actor via <strong>command chaining</strong>.  We see this in the example above on
lines 24, 40, and 41.</p>

<p>While commands <em>can</em> be chained ad infinitum, an appropriate rule of thumb is
 to chain contextually-related commands together, and start a new line when a
 new context arises.  For example, consider starting with a tween command and
 hen successively chaining the commands that are to be tweened.</p>

			</section>

    		<aside id="sidebar">
				<a href="https://github.com/dguzek/Lua-For-SM5/zipball/master" class="button">
					<small>Download</small>
					.zip file
				</a>
				<a href="https://github.com/dguzek/Lua-For-SM5/tarball/master" class="button">
					<small>Download</small>
					.tar.gz file
				</a>

      			<p class="repo-owner">
					Project maintained by <a href="https://github.com/dguzek">dguzek</a>.
				</p>

      			<p>
					This page was generated by <a href="https://pages.github.com">GitHub Pages</a>
					using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
	  			</p>
  			</aside>
		</div>
	</div>
			
</body>
	
</html>